created: 20251204120000000
modified: 20251204120000000
tags:
title: 如何检查系统中 global node_modules
type: text/vnd.tiddlywiki


! 检查方法

!! 使用脚本检查

项目根目录提供了 `check-global-node-modules.sh` 脚本，可以全面检查所有全局 node_modules 路径：

```bash
./check-global-node-modules.sh
```

该脚本会检查以下所有安装工具的全局 node_modules：

* npm（当前使用的）
* nvm
* Homebrew
* n
* Volta
* mise (原 rtx)
* fnm (Fast Node Manager)
* asdf
* 系统级路径

!! 使用 npm 命令检查

!!! 查看当前全局 node_modules 路径

```bash
npm root -g
```

!!! 列出所有全局安装的包

```bash
# 列出所有全局包（仅顶层）
npm list -g --depth=0

# 列出所有全局包（包含依赖）
npm list -g

# 仅显示包名
npm list -g --depth=0 --parseable | xargs -n1 basename
```

!!! 查看全局包信息

```bash
# 查看特定全局包的信息
npm list -g <package-name>

# 查看全局包安装路径
npm list -g <package-name> --parseable
```

!! 手动检查各安装器的全局 node_modules

!!! nvm

nvm 的全局 node_modules 位于每个 Node.js 版本的 `lib/node_modules` 目录：

```bash
# 检查当前使用的版本的全局 node_modules
nvm current
ls -la ~/.nvm/versions/node/$(nvm current)/lib/node_modules

# 检查所有版本的全局 node_modules
for version in ~/.nvm/versions/node/*/lib/node_modules; do
    if [ -d "$version" ]; then
        echo "版本: $(basename $(dirname $(dirname $version)))"
        ls -1 "$version" | head -10
        echo ""
    fi
done
```

!!! Homebrew

Homebrew 的全局 node_modules 通常在以下位置：

```bash
# Intel Mac
ls -la /usr/local/lib/node_modules

# Apple Silicon Mac
ls -la /opt/homebrew/lib/node_modules

# 或者检查 Homebrew 安装的 node 版本目录
BREW_NODE=$(brew --prefix node)
ls -la "$BREW_NODE"/*/lib/node_modules
```

!!! n

n 的全局 node_modules 位于每个 Node.js 版本的 `lib/node_modules` 目录：

```bash
# 默认路径
ls -la /usr/local/n/versions/node/*/lib/node_modules

# 或使用 N_PREFIX 环境变量
N_PREFIX=${N_PREFIX:-/usr/local}
ls -la "$N_PREFIX/n/versions/node"/*/lib/node_modules
```

!!! Volta

Volta 的全局 node_modules 位于每个 Node.js 版本的 `lib/node_modules` 目录：

```bash
# 检查 VOLTA_HOME（默认 ~/.volta）
VOLTA_HOME=${VOLTA_HOME:-~/.volta}
ls -la "$VOLTA_HOME/tools/node"/*/lib/node_modules
```

!!! mise (原 rtx)

mise 的全局 node_modules 位于每个 Node.js 版本的 `lib/node_modules` 目录：

```bash
# 检查 MISE_DATA_DIR（默认 ~/.local/share/mise）
MISE_DATA_DIR=${MISE_DATA_DIR:-~/.local/share/mise}
ls -la "$MISE_DATA_DIR/installs/node"/*/lib/node_modules
```

!!! fnm (Fast Node Manager)

fnm 的全局 node_modules 位于每个 Node.js 版本的 `lib/node_modules` 目录：

```bash
# 检查 FNM_DIR（默认 ~/.fnm）
FNM_DIR=${FNM_DIR:-~/.fnm}
ls -la "$FNM_DIR/node-versions"/*/lib/node_modules
```

!!! asdf

asdf 的全局 node_modules 位于每个 Node.js 版本的 `lib/node_modules` 目录：

```bash
# 检查 ASDF_DATA_DIR（默认 ~/.asdf）
ASDF_DATA_DIR=${ASDF_DATA_DIR:-~/.asdf}
ls -la "$ASDF_DATA_DIR/installs/nodejs"/*/lib/node_modules
```

!! 通用检查方法

!!! 查找所有 node_modules 目录

```bash
# 在常见目录中查找（可能需要 sudo）
find /usr/local /opt $HOME -type d -name node_modules 2>/dev/null

# 仅查找全局 node_modules（排除项目中的）
find /usr/local /opt $HOME -type d -path "*/lib/node_modules" 2>/dev/null

# 使用 locate（需要先更新数据库）
locate lib/node_modules
```

!!! 检查全局包大小

```bash
# 检查当前 npm 全局 node_modules 大小
npm root -g | xargs du -sh

# 检查所有版本的全局 node_modules 大小
for dir in ~/.nvm/versions/node/*/lib/node_modules; do
    if [ -d "$dir" ]; then
        echo "$(basename $(dirname $(dirname $dir))): $(du -sh "$dir" | cut -f1)"
    fi
done
```

!!! 列出所有全局包（跨所有版本管理器）

```bash
# 查找所有全局 node_modules 并列出包
for node_modules in $(find ~/.nvm ~/.volta ~/.local/share/mise ~/.fnm ~/.asdf /usr/local /opt/homebrew -type d -name node_modules -path "*/lib/node_modules" 2>/dev/null); do
    if [ -d "$node_modules" ] && [ "$(ls -A $node_modules 2>/dev/null)" ]; then
        echo "=== $node_modules ==="
        ls -1 "$node_modules" | head -10
        echo ""
    fi
done
```

!! 常见全局 node_modules 路径总结

| 工具 | 全局 node_modules 路径 |
|------|----------------------|
| npm (当前) | `$(npm root -g)` |
| nvm | `~/.nvm/versions/node/<version>/lib/node_modules` |
| Homebrew (Intel) | `/usr/local/lib/node_modules` |
| Homebrew (Apple Silicon) | `/opt/homebrew/lib/node_modules` |
| n | `/usr/local/n/versions/node/<version>/lib/node_modules` 或 `$N_PREFIX/n/versions/node/<version>/lib/node_modules` |
| Volta | `~/.volta/tools/node/<version>/lib/node_modules` |
| mise | `~/.local/share/mise/installs/node/<version>/lib/node_modules` |
| fnm | `~/.fnm/node-versions/<version>/lib/node_modules` |
| asdf | `~/.asdf/installs/nodejs/<version>/lib/node_modules` |

!! 相关命令

!!! 查看全局包详情

```bash
# 查看全局包版本
npm list -g <package-name>

# 查看全局包安装位置
npm list -g <package-name> --parseable

# 查看全局包信息
npm info <package-name>
```

!!! 管理全局包

```bash
# 安装全局包
npm install -g <package-name>

# 卸载全局包
npm uninstall -g <package-name>

# 更新全局包
npm update -g <package-name>

# 更新所有全局包
npm update -g
```

!!! 清理全局包

```bash
# 查看全局包大小
npm root -g | xargs du -sh

# 清理未使用的全局包（需要 npm-check-updates 或类似工具）
npm-check-updates -g -u
```

!! 注意事项

* 不同 Node.js 版本管理器有各自独立的全局 node_modules
* `npm root -g` 显示的是当前激活的 Node.js 版本的全局 node_modules 路径
* 切换 Node.js 版本后，全局包列表会不同（因为每个版本有独立的 node_modules）
* 某些工具（如 Volta）可能在不同版本间共享全局包
* 全局包通常安装在 `<node安装路径>/lib/node_modules` 目录
* 使用 `npm list -g` 时，如果包很多，输出可能很长，建议使用 `--depth=0` 限制深度
* 某些系统级路径可能需要 sudo 权限才能访问

!! 故障排查

!!! 找不到全局包

如果安装了全局包但找不到：

```bash
# 1. 检查 npm 全局路径
npm root -g

# 2. 检查 PATH 中是否包含全局包的 bin 目录
npm bin -g

# 3. 检查当前使用的 node 版本
which node
node --version

# 4. 检查是否在正确的 Node.js 版本下安装的包
npm list -g
```

!!! 全局包命令不可用

```bash
# 检查全局 bin 目录是否在 PATH 中
echo $PATH | tr ':' '\n' | grep -E "node|npm"

# 查看 npm 全局 bin 路径
npm bin -g

# 手动添加到 PATH（如果需要）
export PATH="$(npm bin -g):$PATH"
```
